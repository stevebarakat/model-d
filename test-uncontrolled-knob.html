<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Uncontrolled Knob Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f0f0f0;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .knob-simulation {
        width: 100px;
        height: 100px;
        border: 2px solid #333;
        border-radius: 50%;
        position: relative;
        margin: 20px auto;
        background: #f8f8f8;
      }
      .knob-indicator {
        width: 4px;
        height: 40px;
        background: #333;
        position: absolute;
        top: 10px;
        left: 50%;
        transform-origin: bottom center;
        transform: translateX(-50%) rotate(0deg);
        transition: transform 0.1s ease;
      }
      .controls {
        text-align: center;
        margin: 20px 0;
      }
      button {
        margin: 5px;
        padding: 8px 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .info {
        background: #e9ecef;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>Uncontrolled Knob Test</h1>

    <div class="test-container">
      <h2>Attack/Decay Knob Simulation</h2>
      <p>
        This simulates how the uncontrolled knob works with position-to-value
        mapping:
      </p>

      <div class="knob-simulation">
        <div class="knob-indicator" id="knobIndicator"></div>
      </div>

      <div class="controls">
        <button onclick="adjustKnob(-100)">-100</button>
        <button onclick="adjustKnob(-50)">-50</button>
        <button onclick="adjustKnob(-10)">-10</button>
        <button onclick="adjustKnob(10)">+10</button>
        <button onclick="adjustKnob(50)">+50</button>
        <button onclick="adjustKnob(100)">+100</button>
      </div>

      <div class="info">
        <strong>Knob Position:</strong>
        <span id="position">5000</span> (0-10000)<br />
        <strong>Actual Value:</strong> <span id="value">1000</span> ms<br />
        <strong>Rotation:</strong> <span id="rotation">0</span>Â°
      </div>
    </div>

    <div class="test-container">
      <h2>How it works:</h2>
      <ul>
        <li>
          <strong>Knob Position:</strong> The knob internally works with
          positions 0-10000
        </li>
        <li>
          <strong>Value Mapping:</strong> Parent component converts position to
          actual time value
        </li>
        <li>
          <strong>Visual Rotation:</strong> Based purely on position, ensuring
          smooth movement
        </li>
        <li>
          <strong>Uncontrolled:</strong> Knob doesn't know about the mapping,
          just reports position changes
        </li>
      </ul>
    </div>

    <script>
      // Attack/decay mapping functions (same as in the app)
      const attackDecayStops = [
        { pos: 0, value: 0 },
        { pos: 1000, value: 10 },
        { pos: 2000, value: 200 },
        { pos: 4000, value: 600 },
        { pos: 6000, value: 1000 },
        { pos: 8000, value: 5000 },
        { pos: 10000, value: 10000 },
      ];

      function knobPosToValue(pos, stops = attackDecayStops) {
        for (let i = 0; i < stops.length - 1; i++) {
          const a = stops[i];
          const b = stops[i + 1];
          if (pos >= a.pos && pos <= b.pos) {
            const t = (pos - a.pos) / (b.pos - a.pos);
            return a.value + t * (b.value - a.value);
          }
        }
        return stops[stops.length - 1].value;
      }

      function valueToKnobPos(value, stops = attackDecayStops) {
        for (let i = 0; i < stops.length - 1; i++) {
          const a = stops[i];
          const b = stops[i + 1];
          if (value >= a.value && value <= b.value) {
            const t = (value - a.value) / (b.value - a.value);
            return a.pos + t * (b.pos - a.pos);
          }
        }
        return stops[stops.length - 1].pos;
      }

      function getRotation(value, min, max) {
        const percentage = (value - min) / (max - min);
        return percentage * 290 - 145; // -145 to +145 degrees
      }

      let currentPosition = 5000; // Start at middle position

      function updateDisplay() {
        const actualValue = knobPosToValue(currentPosition);
        const rotation = getRotation(currentPosition, 0, 10000);

        document.getElementById("position").textContent = currentPosition;
        document.getElementById("value").textContent = Math.round(actualValue);
        document.getElementById("rotation").textContent = Math.round(rotation);

        document.getElementById(
          "knobIndicator"
        ).style.transform = `translateX(-50%) rotate(${rotation}deg)`;
      }

      function adjustKnob(delta) {
        currentPosition = Math.max(0, Math.min(10000, currentPosition + delta));
        updateDisplay();
      }

      // Initialize display
      updateDisplay();
    </script>
  </body>
</html>
